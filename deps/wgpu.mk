WGPU_DIR := $(DEPS_DIR)/wgpu
WGPU_MANIFEST := $(WGPU_DIR)/Cargo.toml

WGPU_FFI_DIR := $(WGPU_DIR)/ffi
WGPU_INCLUDE_DIR := $(WGPU_FFI_DIR)
WGPU_WEBGPU_INCLUDE_DIR := $(WGPU_FFI_DIR)/webgpu-headers

WGPU_ARTIFACT_DIR := $(WGPU_DIR)/build
WGPU_ARCHIVE := $(WGPU_ARTIFACT_DIR)/libwgpu_native.a

WGPU_CARGO_MANIFEST_FLAG := \
	--manifest-path $(WGPU_MANIFEST)

WGPU_CARGO_FLAGS := \
	$(WGPU_CARGO_MANIFEST_FLAG) \
	--artifact-dir $(WGPU_ARTIFACT_DIR)

ifeq ($(RELEASE), 1)
	WGPU_CARGO_FLAGS += --release
endif

$(WGPU_ARCHIVE): CARGO_FLAGS += $(WGPU_CARGO_FLAGS)
$(WGPU_ARCHIVE):
	$(PRINT) " CARGO $(notdir $@)\n"
	$(CARGO) build $(CARGO_FLAGS)

.PHONY: clean
clean::
	$(CARGO) clean $(WGPU_CARGO_MANIFEST_FLAG)
	$(RM) $(RM_FLAGS) $(WGPU_ARCHIVE)
